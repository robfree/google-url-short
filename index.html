<html lang="es">
  <head>
    <title>Interfaz de peticiones Ajax</title>
    <link rel="stylesheet" href="style.css" />
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="google-url-short.js"></script>
  </head>
  <body>
    <div id="wrapper" class="center">
      <div class="center">
        <header id="header-top">
          <h1>Interfaz de peticiones Ajax</h1>
        </header>
        <form action="#" method="get">
          <fieldset>
            <div class="margin">
              <label for="r">ELIGE METODO: </label>
              <input id="radio1" type="radio" name="r" value="GET"> GET
              <input id="radio2" type="radio" name="r" value="POST"> POST
            </div>
            <label for="url">URL: </label>
            <input id="url" type="text" name="url" required="required" />
            <label for="url">PARAMETROS: </label>
            <input id="parametros" type="text" name="parametros" disabled="disabled" />
            <input id="boton" type="button" name="name" value="Enviar" />
          </fieldset>
        </form>
      </div>
      <div id="content" class="center margin">
        <div id="resultado" class="center">
          <header>
            <h3>Estado: <span id="estado"></span> </h3>
            <h3>Cabezera: <span id="cabezeras"></span> </h3>
            <hr/>
          </header>
          <br/>
          <code id="codigo">

          </code>
        </div>
      </div>
    </div>
    <footer>
      <p>
        Copyleft (c) 2015 Copyleft Roberto Serrano Diaz-Grande.
      </p>
    </footer>
    <script type="text/javascript">
    $(function() {
        // Opcion get
      $('#radio1').on('click', function(){
        $('#url').focus();
        $('#parametros').attr('disabled', 'disabled');
        $('#parametros').val('parametros desactivados en peticiones get');
      });
      // Opcion post
      $('#radio2').on('click', function(){
        $('#parametros').removeAttr('disabled');
        $('#parametros').val('');
        $('#url').focus();
      });
    });

      var obj;
      var prueba;
      var re = new RegExp("^http");

      function cargaContenido(respuesta, estado, cabezeras) {
        obj = JSON.parse(respuesta);
        $('#codigo').html(respuesta);
        $('#codigo').html(respuesta);
        $('#estado').html(estado);
        $('#cabezeras').html(cabezeras);
      }
      function loader(a) {
        $('#codigo').html(a);
        console.log(a);
      }

      $('#boton').on('click', function() {
        var metodo = $('input[name=r]:checked').val();
        var url = $('#url').val() || undefined;

        // Compruebo el metodo
        if (!metodo) {
          console.log('Metodo no definido');
          $('#codigo').html('ERROR: ELIGE UN METODO')
          throw 'Metodo no definido';
        }
        // Compruebo url
        if (url) {
          if (re.test(url)) {
            ajaxModule.request(url, 'GET', cargaContenido, loader);
          }
          else {
            $('#codigo').html('ERROR: URL MAL FORMADA. EJEMPLO: http://xxx');
          }
        }
         else {
           $('#codigo').html('ERROR: CAMPO URL VACIO.');
           throw 'Error campo url vacio';
         }
      });
    </script>
  </body>
</html>
